version: '3.8'

services:
  auth-service:
    build: ./auth_service
    container_name: music-museum-auth
    ports:
      - "5002:5002"
    environment:
      JWT_SECRET_KEY: "music-museum-secure-key-2025-change-in-production"
      FLASK_ENV: "production"
    restart: unless-stopped
    networks:
      - music-network

  music-service:
    build: ./music_service
    container_name: music-museum-music
    ports:
      - "5000:5000"
    environment:
      STATS_SERVICE_URL: http://stats-service:5001
      AUTH_SERVICE_URL: http://auth-service:5002
      JWT_SECRET_KEY: "music-museum-secure-key-2025-change-in-production"
      FLASK_ENV: "production"
    depends_on:
      - stats-service
      - auth-service
    restart: unless-stopped
    networks:
      - music-network

  stats-service:
    build: ./stats_service
    container_name: music-museum-stats
    ports:
      - "5001:5001"
    environment:
      AUTH_SERVICE_URL: http://auth-service:5002
      JWT_SECRET_KEY: "music-museum-secure-key-2025-change-in-production"
      FLASK_ENV: "production"
    depends_on:
      - auth-service
    restart: unless-stopped
    networks:
      - music-network

  dashboard:
    build: ./dashboard
    container_name: music-museum-dashboard
    ports:
      - "8501:8501"
    environment:
      MUSIC_SERVICE_URL: http://music-service:5000
      STATS_SERVICE_URL: http://stats-service:5001
      AUTH_SERVICE_URL: http://auth-service:5002
      JWT_SECRET_KEY: "music-museum-secure-key-2025-change-in-production"
    depends_on:
      - music-service
      - stats-service
      - auth-service
    restart: unless-stopped
    networks:
      - music-network

networks:
  music-network:
    driver: bridge